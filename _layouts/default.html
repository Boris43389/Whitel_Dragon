<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{{ page.title | default: site.title }}</title>

  {% seo %}

  <!-- Hints for GA & CSE -->
  <link rel="preconnect" href="https://www.googletagmanager.com">
  <link rel="dns-prefetch" href="//www.googletagmanager.com">
  <link rel="preconnect" href="https://cse.google.com">
  <link rel="dns-prefetch" href="//cse.google.com">

  <link rel="stylesheet" href="{{ '/assets/css/styles.css' | relative_url }}">

  {% if jekyll.environment == "production" and site.ga4 %}
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-KX2LDCQ32L"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-KX2LDCQ32L');
</script>
  {% endif %}
</head>
<body>
  <header class="site-header">
    <div class="wrap">
      <div class="brand">
        <a href="{{ site.baseurl }}/">{{ site.title }}</a>
      </div>
      <div class="searchbox">
        <div class="gcse-searchbox-only"
             data-resultsUrl="{{ site.baseurl }}/search.html"
             data-newWindow="false"
             data-enableAutoComplete="true"></div>
      </div>
    </div>
  </header>

  <div class="layout">
    <aside class="sidebar">
      <!-- по умолчанию свёрнуто (нет open) -->
      <details class="archive">
        <summary>Архив по годам</summary>
        <ul class="year-list">
          {% assign years = site.posts
             | group_by_exp:'post',"post.date | date: '%Y'"
             | sort:'name' | reverse %}
          {% for y in years %}
            <li>
              <a href="{{ '/archive.html#y' | append: y.name | relative_url }}">
                {{ y.name }} ({{ y.items | size }})
              </a>
            </li>
          {% endfor %}
        </ul>
      </details>
    </aside>

    <main role="main">
      {{ content }}
    </main>
  </div>

  <footer class="site-footer">
    <div class="wrap">
      <p>© {{ site.time | date: '%Y' }} — {{ site.title }}</p>
    </div>
  </footer>

  {% if site.google_cx %}
  <script async src="https://cse.google.com/cse.js?cx={{ site.google_cx }}"></script>
  {% endif %}

  <!-- 1 колонка по умолчанию, 2 — если левый details открыт -->
  <script>
    (function () {
      var layout = document.querySelector('.layout');
      var d = document.querySelector('.sidebar details.archive');
      if (!layout || !d) return;

      function apply() {
        layout.classList.toggle('side-open', d.open);
      }

      // гарантируем старт со свёрнутого состояния
      if (!d.open && d.hasAttribute('open')) d.removeAttribute('open');

      d.addEventListener('toggle', apply);
      apply();
    })();
  </script>

  <!-- Подмена ссылок vk.com/photo… на локальные картинки -->
  <script defer src="{{ '/assets/js/vk-photos.js' | relative_url }}"></script>
</body>
</html>
